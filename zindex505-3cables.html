<!DOCTYPE html>
<meta charset="utf-8">
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>

</head>
<body style="cursor:crosshair"></body>
<div id="viewframe" class="viewframe"></div>
<script src="elem-enls.js"></script>
<script src="elem-ents.js"></script>

<script>

// md: # md:{filename}
// md: **earth geometry, graticule, tiles and cables**
// md: originally in three.js (m.init.webgl:1) runs also in svg (m.init.svg:1)
// md: geometry conformed by conform, rotation on wen control (m.init.wen:1)

// md: references:
// md: http://bl.ocks.org/mbostock/bfe064713436955c1ace
// md: land = `topojson.feature(topo, topo.objects.land),`
// md: borders = `topojson.mesh(topo, topo.objects.countries, function(a, b) { return a !== b; }),`
// md: cables = `topojson.feature(topo, topo.objects.cables),`
// md: landings = `topojson.feature(topo, topo.objects.landings),`
// md:
// md: # license
// md: MIT

let muonAlima = function muonAlima (__mapper) {
  __mapper({'xs': xs.xs(__mapper)}) // PROXIES
  __mapper('xs').m('init')({svg: 0, versor: 0, wen: 1, webgl: 1, key: 1}) // INIT

  let f = __mapper('xs').m('props'),
    mnat = __mapper('xs').m('nat'),
    mgeom = __mapper('xs').m('geom'),
    mfibonat = __mapper('xs').m('fibonat'),
    cwen = __mapper('xs').c('wen')(),
    cversor = __mapper('xs').c('versor')

  // .................. pics

  let tim = {'td': 22800, 't0': 0, 't1': 1000, 't2': 1, 't3': 1}
  let formGrat = {

    'x': {
      'm1': [[[4, 4]]], 'm2': [[[4, 4]]], 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
      'm1': 3, 'm2': 3, 'n1': 1, 'n2': 1, 'n3': 1, 'a': 1, 'b': 1, //
      'm1': [[[4, 8]]], 'm2': [[[4, 8]]], 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
      'm1': 4, 'm2': 4, 'n1': 100, 'n2': 100, 'n3': 100, 'a': 1, 'b': 1, // square
      'm1': 6, 'm2': 6, 'n1': 60, 'n2': 100, 'n3': 30, 'a': 1, 'b': 1,
      "m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle

      'ra2': 180,
      'v0': 0, 'v1': 1,
      // "w4":  [[[0,0,0,-9 * 90,-9 * 90 ,0 ,0]]], // [[[180,360,180]]], // [[[0,-360,0]]],
      'w4': 0, // [[[180,360,180]]], // [[[0,-360,0]]],
      'seg5': 360, 'pa6': 0, 'pb7': -1,
      'fas8': 0
    },
    'y': {
      'm1': [[[4, 4]]], 'm2': [[[4, 4]]], 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
      'm1': 3, 'm2': 3, 'n1': 1, 'n2': 1, 'n3': 1, 'a': 1, 'b': 1, //
      'm1': [[[4, 8]]], 'm2': [[[4, 8]]], 'n1': 27, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1, // circle
      'm1': 4, 'm2': 4, 'n1': 100, 'n2': 100, 'n3': 100, 'a': 1, 'b': 1, // square
      'm1': 6, 'm2': 6, 'n1': 60, 'n2': 100, 'n3': 30, 'a': 1, 'b': 1,
      "m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle

      'ra2': 180,
      'v0': 0, 'v1': 1,
      // "w4": [[[0,0,0,-9 * 90,-9 * 90, 0 ,0]]], //  [[[60, 60 + 1 * 360]]], // [[[0,-360,0]]],
      'w4': 0, //  [[[60, 60 + 1 * 360]]], // [[[0,-360,0]]],
      'seg5': 360, 'pa6': 0, 'pb7': -1,
      'fas8': 0 		// fas8, antifase
    },
    'z': {
      // "m1":[[[3,3]]],"m2":[[[3,3]]],"n1":1,"n2":1,"n3":1,"a":1,"b":1, // tri
      // "m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1, // 			// circle
      // "m1":[[[4,8]]],"m2":[[[4,8]]],"n1":2,"n2":2,"n3":2,"a":1,"b":1,
      // "m1":2,"m2":2,"n1":10,"n2":10,"n3":10,"a":1,"b":1, //
      // "m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle
      // "m1":[[[4,8]]],"m2":[[[4,8]]],"n1":[[[100,300]]],"n2":[[[100,300]]],"n3":[[[100,300]]],"a":1,"b":1, // square
      'm1': 2, 'm2': 2, 'n1': 1, 'n2': 1, 'n3': 1, 'a': 1, 'b': 1, //
      "m1":4,"m2":4,"n1":2,"n2":2,"n3":2,"a":1,"b":1,// circle

      // "ra2": [[[30,260/  Math.sqrt(2),260/  Math.sqrt(2)]]],
      // "ra2": [[[262/  Math.sqrt(2), 262/  Math.sqrt(2), 262/  Math.sqrt(2) , 262/  Math.sqrt(2), 262/  Math.sqrt(2) ]]],
      'ra2': 180,
      'v0': 0, 'v1': 1,
      'w4': 0, // [[[180,360,180]]], // [[[0,-360,0]]],
      'seg5': 360, 'pa6': 0, 'pb7': -1,
      'fas8': 0
    }
  }

  let landForm = {

    'x': {
      'm1': 6, 'm2': 6, 'n1': 60, 'n2': 100, 'n3': 30, 'a': 1, 'b': 1,
      'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,
      'ra2': 180,
      'v0': 0, 'v1': 1,
      'w4': 0, // [[[180,360,180]]], // [[[0,-360,0]]],
      'seg5': 360, 'pa6': 0, 'pb7': -1,
      'fas8': 0
    },
    'y': {
      'm1': 6, 'm2': 6, 'n1': 60, 'n2': 100, 'n3': 30, 'a': 1, 'b': 1,
      'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,
      'ra2': 180,
      'v0': 0, 'v1': 1,
      'w4': 0, //  [[[60, 60 + 1 * 360]]], // [[[0,-360,0]]],
      'seg5': 360, 'pa6': 0, 'pb7': -1,
      'fas8': 0 		// fas8, antifase
    },
    'z': {
      'm1': 3, 'm2': 3, 'n1': 1, 'n2': 1, 'n3': 1, 'a': 1, 'b': 1, //
      'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1,
      'ra2': [[[1,1,180,180]]],
      'v0': 0, 'v1': 1,
      'w4': 0, // [[[180,360,180]]], // [[[0,-360,0]]],
      'seg5': 360, 'pa6': 0, 'pb7': -1,
      'fas8': 0
    }
  }

  let graticule = {

    extent: [ [-180, 180, [[[12, 12]]], 12], [-180, 180, 12, 12] ]
    // extent: [ [-180, 180, 90, 12],  [-90, 90, 360, 6] ],

  }
  let conform = {

    projection: 'natform',
    form: formGrat

  }

  let proform = {

    prerotate: [[[ cwen.rotation ]]],
    projection: 'uniwen',
    translate: [ 0, 0, 0],
    rotate: [ 0, 0, 0 ],
    scale: 1

  }
  // .................. threegrat
  let threegrat = {

    halo: 'ent',

    geofold: p => __mapper('xs').m('graticule').vhMultiLine(p.payload.graticule),

    payload: {

      tim: tim,
      ric: {'gid': 'threegrat', 'cid': 'threegrat', 'fid': 'threegrat'},
      boform: { 'csx': 0, 'cf': [[[615, 566]]], 'cs': 333, 'cw': 0.1, 'co': [[[0.03, 0.03]]], 'cp': [[[0.6, 0.6]]]},
      conform: conform,
      proform: proform,
      graticule: {frame: [ [ [-180, 180, 12, 12], [-90, 90, 12, 12] ] ] }

    }

  }
  // .................. threecables
  let threecables = {

    halo: 'ent',

    geofold: p => topojson.mesh(
      __mapper("xs").d("worldCables110m").data(),
      __mapper("xs").d("worldCables110m").data().objects.cables),

    payload: {

      tim: tim,
      ric: {'gid': 'threecables', 'cid': 'threecables', 'fid': 'threecables'},
      boform: { 'csx': 0, 'cf': [[[615, 566]]], 'cs': 333, 'cw': 0.1, 'co': [[[0.03, 0.03]]], 'cp': [[[0.6, 0.6]]]},
      conform: conform,
      proform: proform,
      graticule: {frame: [ [ [-180, 180, 12, 12], [-90, 90, 12, 12] ] ] }

    }

  }

  // .................. threeland
  let threeland = {

    halo: 'ent',

    geofold: p => topojson.feature(
      __mapper('xs').d('worldTopo110m').data(),
      __mapper('xs').d('worldTopo110m').data().objects.land),

    payload: {
      tim,
      conform: landForm,
      proform: proform,
      ric: {'gid': 'geoearth', 'cid': 'geoearth', 'fid': 'geoearthFront'},
      boform: { 'csx': 0, 'cf': 555, 'cs': 333, 'cw': 0.2, 'co': 1, 'cp': 0.9}
    }

  }

  // .................. animaApi
  let animas = [
    threecables,
    // threegrat,
    // threeland
  ]

  let animaApi = function animaApi () {
    __mapper('xs').m('store').apply({'type': 'UPDANIMA', 'caller': 'alima', 'animas': animas})
  }

  return animaApi
}

let __mapper = muonMapper.muonMapper()
__mapper({'muonAlima': muonAlima(__mapper)}).muonAlima(__mapper)
</script>
<body style="cursor:crosshair"></body>
