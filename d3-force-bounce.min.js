// Version 0.5.5 d3-force-bounce - https://github.com/vasturiano/d3-force-bounce
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(t.d3=t.d3||{})}(this,function(t){"use strict";function n(t,n,r,i){if(isNaN(n)||isNaN(r))return t;var e,o,h,s,a,u,f,l,x,y=t._root,_={data:i},c=t._x0,v=t._y0,d=t._x1,p=t._y1;if(!y)return t._root=_,t;for(;y.length;)if((u=n>=(o=(c+d)/2))?c=o:d=o,(f=r>=(h=(v+p)/2))?v=h:p=h,e=y,!(y=y[l=f<<1|u]))return e[l]=_,t;if(s=+t._x.call(null,y.data),a=+t._y.call(null,y.data),n===s&&r===a)return _.next=y,e?e[l]=_:t._root=_,t;do{e=e?e[l]=new Array(4):t._root=new Array(4),(u=n>=(o=(c+d)/2))?c=o:d=o,(f=r>=(h=(v+p)/2))?v=h:p=h}while((l=f<<1|u)==(x=(a>=h)<<1|s>=o));return e[x]=y,e[l]=_,t}function r(t){return t[0]}function i(t){return t[1]}function e(t,n,e){var h=new o(null==n?r:n,null==e?i:e,NaN,NaN,NaN,NaN);return null==t?h:h.addAll(t)}function o(t,n,r,i,e,o){this._x=t,this._y=n,this._x0=r,this._y0=i,this._x1=e,this._y1=o,this._root=void 0}function h(t){for(var n={data:t.data},r=n;t=t.next;)r=r.next={data:t.data};return n}var s=function(t,n,r,i,e){this.node=t,this.x0=n,this.y0=r,this.x1=i,this.y1=e},a=e.prototype=o.prototype;a.copy=function(){var t,n,r=new o(this._x,this._y,this._x0,this._y0,this._x1,this._y1),i=this._root;if(!i)return r;if(!i.length)return r._root=h(i),r;for(t=[{source:i,target:r._root=new Array(4)}];i=t.pop();)for(var e=0;e<4;++e)(n=i.source[e])&&(n.length?t.push({source:n,target:i.target[e]=new Array(4)}):i.target[e]=h(n));return r},a.add=function(t){var r=+this._x.call(null,t),i=+this._y.call(null,t);return n(this.cover(r,i),r,i,t)},a.addAll=function(t){var r,i,e,o,h=t.length,s=new Array(h),a=new Array(h),u=1/0,f=1/0,l=-1/0,x=-1/0;for(i=0;i<h;++i)isNaN(e=+this._x.call(null,r=t[i]))||isNaN(o=+this._y.call(null,r))||(s[i]=e,a[i]=o,e<u&&(u=e),e>l&&(l=e),o<f&&(f=o),o>x&&(x=o));for(l<u&&(u=this._x0,l=this._x1),x<f&&(f=this._y0,x=this._y1),this.cover(u,f).cover(l,x),i=0;i<h;++i)n(this,s[i],a[i],t[i]);return this},a.cover=function(t,n){if(isNaN(t=+t)||isNaN(n=+n))return this;var r=this._x0,i=this._y0,e=this._x1,o=this._y1;if(isNaN(r))e=(r=Math.floor(t))+1,o=(i=Math.floor(n))+1;else{if(!(r>t||t>e||i>n||n>o))return this;var h,s,a=e-r,u=this._root;switch(s=(n<(i+o)/2)<<1|t<(r+e)/2){case 0:do{h=new Array(4),h[s]=u,u=h}while(a*=2,e=r+a,o=i+a,t>e||n>o);break;case 1:do{h=new Array(4),h[s]=u,u=h}while(a*=2,r=e-a,o=i+a,r>t||n>o);break;case 2:do{h=new Array(4),h[s]=u,u=h}while(a*=2,e=r+a,i=o-a,t>e||i>n);break;case 3:do{h=new Array(4),h[s]=u,u=h}while(a*=2,r=e-a,i=o-a,r>t||i>n)}this._root&&this._root.length&&(this._root=u)}return this._x0=r,this._y0=i,this._x1=e,this._y1=o,this},a.data=function(){var t=[];return this.visit(function(n){if(!n.length)do{t.push(n.data)}while(n=n.next)}),t},a.extent=function(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},a.find=function(t,n,r){var i,e,o,h,a,u,f,l=this._x0,x=this._y0,y=this._x1,_=this._y1,c=[],v=this._root;for(v&&c.push(new s(v,l,x,y,_)),null==r?r=1/0:(l=t-r,x=n-r,y=t+r,_=n+r,r*=r);u=c.pop();)if(!(!(v=u.node)||(e=u.x0)>y||(o=u.y0)>_||(h=u.x1)<l||(a=u.y1)<x))if(v.length){var d=(e+h)/2,p=(o+a)/2;c.push(new s(v[3],d,p,h,a),new s(v[2],e,p,d,a),new s(v[1],d,o,h,p),new s(v[0],e,o,d,p)),(f=(n>=p)<<1|t>=d)&&(u=c[c.length-1],c[c.length-1]=c[c.length-1-f],c[c.length-1-f]=u)}else{var w=t-+this._x.call(null,v.data),g=n-+this._y.call(null,v.data),N=w*w+g*g;if(N<r){var A=Math.sqrt(r=N);l=t-A,x=n-A,y=t+A,_=n+A,i=v.data}}return i},a.remove=function(t){if(isNaN(o=+this._x.call(null,t))||isNaN(h=+this._y.call(null,t)))return this;var n,r,i,e,o,h,s,a,u,f,l,x,y=this._root,_=this._x0,c=this._y0,v=this._x1,d=this._y1;if(!y)return this;if(y.length)for(;;){if((u=o>=(s=(_+v)/2))?_=s:v=s,(f=h>=(a=(c+d)/2))?c=a:d=a,n=y,!(y=y[l=f<<1|u]))return this;if(!y.length)break;(n[l+1&3]||n[l+2&3]||n[l+3&3])&&(r=n,x=l)}for(;y.data!==t;)if(i=y,!(y=y.next))return this;return(e=y.next)&&delete y.next,i?(e?i.next=e:delete i.next,this):n?(e?n[l]=e:delete n[l],(y=n[0]||n[1]||n[2]||n[3])&&y===(n[3]||n[2]||n[1]||n[0])&&!y.length&&(r?r[x]=y:this._root=y),this):(this._root=e,this)},a.removeAll=function(t){for(var n=0,r=t.length;n<r;++n)this.remove(t[n]);return this},a.root=function(){return this._root},a.size=function(){var t=0;return this.visit(function(n){if(!n.length)do{++t}while(n=n.next)}),t},a.visit=function(t){var n,r,i,e,o,h,a=[],u=this._root;for(u&&a.push(new s(u,this._x0,this._y0,this._x1,this._y1));n=a.pop();)if(!t(u=n.node,i=n.x0,e=n.y0,o=n.x1,h=n.y1)&&u.length){var f=(i+o)/2,l=(e+h)/2;(r=u[3])&&a.push(new s(r,f,l,o,h)),(r=u[2])&&a.push(new s(r,i,l,f,h)),(r=u[1])&&a.push(new s(r,f,e,o,l)),(r=u[0])&&a.push(new s(r,i,e,f,l))}return this},a.visitAfter=function(t){var n,r=[],i=[];for(this._root&&r.push(new s(this._root,this._x0,this._y0,this._x1,this._y1));n=r.pop();){var e=n.node;if(e.length){var o,h=n.x0,a=n.y0,u=n.x1,f=n.y1,l=(h+u)/2,x=(a+f)/2;(o=e[0])&&r.push(new s(o,h,a,l,x)),(o=e[1])&&r.push(new s(o,l,a,u,x)),(o=e[2])&&r.push(new s(o,h,x,l,f)),(o=e[3])&&r.push(new s(o,l,x,u,f))}i.push(n)}for(;n=i.pop();)t(n.node,n.x0,n.y0,n.x1,n.y1);return this},a.x=function(t){return arguments.length?(this._x=t,this):this._x},a.y=function(t){return arguments.length?(this._y=t,this):this._y};var u=function(t){return function(){return t}};t.forceBounce=function(){function t(){function t(t,n,r,i){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;return{a:(e*n*(i-r)+t*r+n*i)/(t+n),b:(e*t*(r-i)+t*r+n*i)/(t+n)}}function s(t,n){var r=a(t.x,t.y);return u(r.d,r.a+n)}function a(t,n){return t=t||0,{d:Math.sqrt(t*t+n*n),a:0===t&&0===n?0:Math.atan(n/t)+(t<0?Math.PI:0)}}function u(t,n){return{x:t*Math.cos(n),y:t*Math.sin(n)}}var f=e(n,function(t){return t.x},function(t){return t.y}).visitAfter(function(t){if(t.data)return t.r=i(t.data);for(var n=t.r=0;n<4;++n)t[n]&&t[n].r>t.r&&(t.r=t[n].r)});n.forEach(function(n){var e=i(n);f.visit(function(i,f,l,x,y){var _=i.data,c=i.r,v=e+c;if(!_)return f>n.x+v||x<n.x-v||l>n.y+v||y<n.y-v;if(_.index>n.index){if(n.x===_.x&&n.y===_.y){var d=u(1e-6,2*Math.random()*Math.PI);_.x+=d.x,_.y+=d.y}var p=a(_.x-n.x,_.y-n.y),w=Math.max(0,v-p.d);if(!w)return;var g=s({x:n.vx,y:n.vy},-p.a),N=s({x:_.vx,y:_.vy},-p.a),A=t(o(n),o(_),g.x,N.x,r);g.x=A.a,N.x=A.b;var M=s(g,p.a);n.vx=M.x,n.vy=M.y;var m=s(N,p.a);_.vx=m.x,_.vy=m.y;var b=u(w,p.a),k=e/(e+c);n.x-=b.x*(1-k),n.y-=b.y*(1-k),_.x+=b.x*k,_.y+=b.y*k,h&&h(n,_)}})})}var n=void 0,r=1,i=function(t){return 1},o=function(t){return Math.pow(i(t),2)},h=void 0;return t.initialize=function(t){n=t},t.elasticity=function(n){return arguments.length?(r=n,t):r},t.radius=function(n){return arguments.length?(i="function"==typeof n?n:u(+n),t):i},t.mass=function(n){return arguments.length?(o="function"==typeof n?n:u(+n),t):o},t.onImpact=function(n){return arguments.length?(h=n,t):h},t},Object.defineProperty(t,"__esModule",{value:!0})});