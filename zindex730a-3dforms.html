<!DOCTYPE html>
<meta charset='utf-8'>
<title>animas</title>
<head >

  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    div#fps,svg { position: fixed; top:0; left:0; color: white; }
  </style>

</head>
<body style='cursor:crosshair'></body>
<div id='viewframe' class='viewframe'></div>

<script src='script-enls.js'></script>
<script src='script-ents.js'></script>

<script>

let muonAlima = function muonAlima (__mapper) {
  __mapper({'xs': xs.xs(__mapper)}) // PROXIES
  __mapper('xs').m('init')({svg: 1, versor: 0, wen: 1, webgl: 0, bck: 0}) // INIT

  let f = __mapper('xs').m('props'),
    msnap = __mapper('xs').m('snap'),
    mlacer = __mapper('xs').m('lacer'),
    mnat = __mapper('xs').m('nat'),
    mgraticule = __mapper('xs').m('graticule')

  /*******************************************
 *      @pics
 */
  let tim = {'td': 12800, 't0': 0, 't1': 1000, 't2': 1, 't3': 1}
  let boform = { csx: 0, cf: 777, cs: 666, cw: 0.7, co: 0.07, cp: 0.9}
  let geofold = {type: 'Feature', geometry: { type: 'Point', coordinates: [0, 0]}, properties: {pointRadius: 6}}

  let translate = {'m1': 4,
    'm2': 4,'n1': 2,'n2': 2,'n3': 2,'a': 1,'b': 1, // circle
    'ra2': 60,'v0': 0,'v1': 1,'w4': 90,'seg5': 360,'pa6': 0,'pb7': -1,
    }
  let proform = {projection: 'uniwen', scale: 1, translate: [ 0, 0, 0 ], rotate: [ 0, 0, 0 ], lens: [0, 1, Infinity],
        control: 'wen'}
  let conform = { 'm1': 4, 'm2': 4, 'n1': 2, 'n2': 2, 'n3': 2, 'a': 1, 'b': 1}

  let f1x = {		// http://paulbourke.net/geometry/supershape/C_0011.jpg
    'm1': 8,'m2': 8,'n1': 60,'n2': 100,'n3': 30,'a': 1,'b': 1,	//
    'ra2': 60,'v0': 0,'v1': 1,'seg5': 120,'w4': 0,'pa6': 0,'pb7': -1,
    
    'dom3': [-180, 180],
    
    
  }
  let f1y = {
    'm1': 8,'m2': 8,'n1': 60,'n2': 100,'n3': 30,'a': 1,'b': 1,	//
    'ra2': 60,'v0': 0,'v1': 1,'seg5': 120,'w4': 0,'pa6': 0,'pb7': -1,
    
    'dom3': [-180, 180],
    
    
  }
  let f1z = {
    'm1': 2,
    'm2': 2,
    'n1': 10,
    'n2': 10,
    'n3': 10,
    'a': 1,
    'b': 1,	//
    'ra2': 60 / Math.sqrt(2),
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }

  let f2x = {		// http://paulbourke.net/geometry/supershape/C_0033.jpg
    'm1': 1,
    'm2': 1,
    'n1': 37.41,
    'n2': -0.24,
    'n3': 19.07,
    'a': 1,
    'b': 1,	//
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
    
  }
  let f2y = {
    'm1': 1,
    'm2': 1,
    'n1': 37.41,
    'n2': -0.24,
    'n3': 19.07,
    'a': 1,
    'b': 1,	//
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
    
  }
  let f2z = {
    'm1': 4,
    'm2': 4,
    'n1': 100,
    'n2': 100,
    'n3': 100,
    'a': 1,
    'b': 1,	//
    'ra2': 60 / Math.sqrt(2),
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }

  let f3x = {
    'm1': 6,
    'm2': 6,
    'n1': 2,
    'n2': 7,
    'n3': 7,
    'a': 1,
    'b': 1,	// star
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    
  }
  let f3y = {
    'm1': 6,
    'm2': 6,
    'n1': 2,
    'n2': 7,
    'n3': 7,
    'a': 1,
    'b': 1,	// star
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f3z = {
    'm1': 6,
    'm2': 6,
    'n1': 2,
    'n2': 7,
    'n3': 7,
    'a': 1,
    'b': 1,	// star
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f4x = {
    'm1': 8,
    'm2': 8,
    'n1': 60,
    'n2': 100,
    'n3': 30,
    'a': 1,
    'b': 1,	//
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f4y = {
    'm1': 8,
    'm2': 8,
    'n1': 60,
    'n2': 100,
    'n3': 30,
    'a': 1,
    'b': 1,	//
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f4z = {
    'm1': 2,
    'm2': 2,
    'n1': 10,
    'n2': 10,
    'n3': 10,
    'a': 1,
    'b': 1,	//
    'ra2': 60 / Math.sqrt(2),
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-90, 90],
    
  }
  let f5x = {
    'm1': 8,
    'm2': 38,
    'n1': 60,
    'n2': 100,
    'n3': 30,
    'a': 1,
    'b': 1,	//
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f5y = {
    'm1': 8,
    'm2': 38,
    'n1': 60,
    'n2': 100,
    'n3': 30,
    'a': 1,
    'b': 1,	//
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f5z = {
    'm1': 2,
    'm2': 2,
    'n1': 10,
    'n2': 10,
    'n3': 10,
    'a': 1,
    'b': 1,	//
    'ra2': 60 / Math.sqrt(2),
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f6x = {
    'm1': 4,
    'm2': 4,
    'n1': 2,
    'n2': 2,
    'n3': 2,
    'a': 1,
    'b': 1,	// circle
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f6y = {
    'm1': 4,
    'm2': 4,
    'n1': 2,
    'n2': 2,
    'n3': 2,
    'a': 1,
    'b': 1,	// circle
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f6z = {
    'm1': 4,
    'm2': 4,
    'n1': 2,
    'n2': 2,
    'n3': 2,
    'a': 1,
    'b': 1,	// circle
    'ra2': 60 / Math.sqrt(2),
    'v0': 0,
    'v1': 1,
    'seg5': 120,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f7x = {
    'm1': 3,
    'm2': 3,
    'n1': 1,
    'n2': 1,
    'n3': 1,
    'a': 1,
    'b': 1, // tri
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f7y = {
    'm1': 3,
    'm2': 3,
    'n1': 1,
    'n2': 1,
    'n3': 1,
    'a': 1,
    'b': 1, // tri
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f7z = {
    'm1': 3,
    'm2': 3,
    'n1': 1,
    'n2': 1,
    'n3': 1,
    'a': 1,
    'b': 1, // tri
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f8x = {
    'm1': 3.93,
    'm2': 3.93,
    'n1': 2,
    'n2': 2,
    'n3': 1,
    'a': 2.5,
    'b': 1, // ellipse eye
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f8y = {
    'm1': 3.93,
    'm2': 3.93,
    'n1': 2,
    'n2': 2,
    'n3': 1,
    'a': 2.5,
    'b': 1, // ellipse eye
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f8z = {
    'm1': 3.93,
    'm2': 3.93,
    'n1': 2,
    'n2': 2,
    'n3': 1,
    'a': 2.5,
    'b': 1, // ellipse eye
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f9x = {
    'm1': 5,
    'm2': 5,
    'n1': 1000,
    'n2': 600,
    'n3': 600,
    'a': 1,
    'b': 1, // pentagon
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
    
  }
  let f9y = {
    'm1': 5,
    'm2': 5,
    'n1': 1000,
    'n2': 600,
    'n3': 600,
    'a': 1,
    'b': 1, // pentagon
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
    
  }
  let f9z = {
    'm1': 5,
    'm2': 5,
    'n1': 1000,
    'n2': 600,
    'n3': 600,
    'a': 1,
    'b': 1, // pentagon
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
    'dom3': [-180, 180],
    
  }
  let f10x = {
    'm1': 4,
    'm2': 4,
    'n1': 100,
    'n2': 100,
    'n3': 100,
    'a': 1,
    'b': 1, // square
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 64,
    'w4': 60,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f10y = {
    'm1': 4,
    'm2': 4,
    'n1': 100,
    'n2': 100,
    'n3': 100,
    'a': 1,
    'b': 1, // square
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 64,
    'w4': 60,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f10z = {
    'm1': 4,
    'm2': 4,
    'n1': 2,
    'n2': 2,
    'n3': 2,
    'a': 1,
    'b': 1, // circle
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 64,
    'w4': 60,
    'pa6': 0,
    'pb7': -1,
    
  }

  let f12x = {
    'm1': 6,
    'm2': 6,
    'n1': 1000,
    'n2': 400,
    'n3': 400,
    'a': 1,
    'b': 1, // hexagon
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f12y = {
    'm1': 6,
    'm2': 6,
    'n1': 1000,
    'n2': 400,
    'n3': 400,
    'a': 1,
    'b': 1, // hexagon
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 0,
    'pa6': 0,
    'pb7': -1,
    
  }
  let f12z = {
    'm1': 6,
    'm2': 6,
    'n1': 1000,
    'n2': 400,
    'n3': 400,
    'a': 1,
    'b': 1, // hexagon
    'ra2': 60,
    'v0': 0,
    'v1': 1,
    'seg5': 360,
    'w4': 90,
    'pa6': 0,
    'pb7': -1,
    
  }

  /*******************************************
 *    @animas
 */
  let p1 = {
    halo: 'ent',
    geofold: p => mnat.natFeature({x: f2x, y: f2y, z: f2z}),
    payload: {tim,
      boform,
      ric: {'gid': 'p', 'cid': 'p', 'fid': 'p1'},
      proform: Object.assign({}, proform, {translate: [150 - 300, 100 - 200, 0] })}
  }
  let p2 = {
    halo: 'ent',
    geofold: p => mnat.natFeature({x: f2x, y: f2y, z: f2z}),
    payload: {tim,
      boform,
      ric: {'gid': 'p', 'cid': 'p', 'fid': 'p2'},
      proform: Object.assign({}, proform, {translate: [250 - 300, 100 - 200, 0] })
    }
  }
  let p3 = {
    halo: 'ent',
    geofold: mnat.natFeature({x: f3x, y: f3y, z: f3z}),
    payload: {tim,
      boform,
      form: {x: f3x, y: f3y, z: f3z},
      ric: {'gid': 'p', 'cid': 'p', 'fid': 'p3'},
      proform: Object.assign({}, proform, {translate: [350 - 300, 100 - 200, 0] })}
  }
  let p4 = {
    halo: 'ent',
    geofold: p => mgraticule.vhMultiLine({'lattice': [ [180, 45], [90, 22.5] ]}),
    payload: {tim,
      ric: {'gid': 'p', 'cid': 'p', 'fid': 'p4'},
      boform,
      conform: {'projection': 'natform', 'form': {x: f4x, y: f4y, z: f4z}},
      proform: Object.assign({}, proform, {translate: [300 - 300, 200 - 200, 0] })} // [450, 100, 0] })}
  }
  let p5 = {
    halo: 'ent',
    geofold: p => {
      let vertices = mgraticule.gvertices({'lattice': [ [180, 55], [90, 2.5] ]})  
        .geometry.coordinates
      let faces = mgraticule.gfaces({'lattice': [ [180, 55], [90, 2.5] ]})
      faces = faces.map(face => [...face, face[0]])
      faces = faces.map(face => // faces : points => vertices
        face.map(vi => vertices[vi]) // eg. [1, 0, 3, 2, 1]
      ) //  (2) [-180, -45] [0, 0] [-180, 0]
      let features = faces.map(face => ({
        type: 'Feature', geometry: {type: 'Polygon', coordinates: Array.of(face)}, properties: {}}))
      return {type: 'FeatureCollection', features}
    },
    payload: {tim,
      ric: {'gid': 'p', 'cid': 'p', 'fid': 'p5'},
      boform,
      conform: {'projection': 'natform', 'form': {x: f5x, y: f5y, z: f5z}},
      proform: Object.assign({}, proform, {translate: [150 - 300, 200 - 200, 0], rotate: [ [[[0, 90]]], [[[0, 90]]], 0] })}
  }

  let p6 = {
    halo: 'nat',
    geofold: null,
    payload: {tim,
      boform,
      form: {x: f6x, y: f6y, z: f6z},
      ric: {'gid': 'p', 'cid': 'p', 'fid': 'p6'},
      proform: Object.assign({}, proform, {translate: [400 - 300, 300 - 200, 0] })}
  }

  // geoearth
  let geoearth = {

    halo: 'ent',
    geofold: () => {
      let gj = Object.assign({},
        topojson.feature(
          __mapper('xs').d('worldTopo110m').data(),
          __mapper('xs').d('worldTopo110m').data().objects.land
        )
      )
      gj = __mapper('xs').m('geoj').trim(gj)
      return gj
    },
    payload: {
      tim: tim,
      ric: {'gid': 'geoearth', 'cid': 'geoearth', 'fid': 'geoearth'},
      boform: { 'csx': 0, 'cf': [[[555, 333, 555, 333, 555, 333, 555]]], 'cs': 333, 'cw': 0.2, 'co': 0.4, 'cp': 0.9},
      proform: {
        'projection': 'orthographic',
        'scale': [[[100, 0.5]]],
        'translate': [100 - 300, 300 - 200, 0],
        'rotate': [ [[[0, -1 * 360]]], 0, 0 ],
        'control': 'versor'

      }
    }

  }

  let animas = [
    p1, // h.ent g.uniwen
    p2, // h.ent g.uniwen
    p3, // h.ent g.uniwen
    p4, // h.ent g.uniwen
    p5, // h.ent g.uniwen
    p6, // h.ent g.uniwen

    geoearth // h.ent g.orthographic

  ]

  return () => __mapper('xs').m('store').apply({'type': 'UPDANIMA', 'caller': 'alima', 'animas': animas})
}

let __mapper = muonMapper.muonMapper()
__mapper({'muonAlima': muonAlima(__mapper)}).muonAlima(__mapper)
</script>
<body style='cursor:crosshair'></body>
